---
layout: post
title:  "解决 Chrome/Chromium 在 Linux 下每次重启需要重新登录的问题"
date:   2016-11-10 20:32:30 +0800
tags: [折腾,Linux]
---

近来Linux玩儿的比较顺手，换桌面环境玩儿，结果搞出一个问题：Chrome浏览器每次重启之后都要重新输入密码。

`您的账户已发生变化，需要重新登录`

登录之后一切正常，完全关掉Chrome再开也没问题，可以持续到下一次重启。对于开启了两步验证（短信验证）的用户来说，还是比较烦人的。

搜了一下，有人让关掉访客登录，有人让删掉用户重来。然而我连卸载重装/清理`home`目录/卸掉Chrome换Chromium都搞了，毛用没有。

自力更生，从命令行开Chrome，报一个`authority failed`一类的错误，于是想到之前用KDE桌面的时候，时不时会弹出个窗口让解锁密钥环，但是换到Mate/Unity之后很久没见到过这个窗口了，会是与这个有关吗？

于是查`dpkg -l`，看到几个可疑的`gnome-keyring`一类的包，还有一个`unity-keyring`，以为是中间玩Mate桌面的时候这个东西没有卸载干净，于是卸载之，结论是……没用……

继续折腾，在Dash面板输入`key`，出来一个“密码和秘钥”的程序，进入之，发现里面储存着大量的网站账号密码，显然是Chrome放在这里的。左侧有一些秘钥库名字，以及锁图标。储存网站账号密码的这个库（或者应该叫密钥环）名为`Default`。搜索得知这个程序名为`seahorse`。

尝试性重启，然后不打开Chrome，而是先到seahorse这里，右键选中`Default`密钥环-解锁。然后也没弹出验证，就直接解锁了。此时再打开Chrome，一切正常，不用重新登录。

至此得出结论，由于我玩桌面环境或者Chrome的原因，造成Chrome无法自行调用这里的解锁密钥环功能，然后每次开机无法取到这里的密码，为了安全只能要求重新从Google服务器获取，于是就需要重新进行Google账户的认证。回忆以往，确实有一些情况下，开机后第一次打开Chrome时，会要求输入解锁密钥环的密码。

然后，每次开机先去手动解锁密钥环也不比每次重新登录好多少。一种办法是在seahorse中将`Default`密钥环的解锁密码修改为空密码，可以做到每次开机后不用做任何操作即可直接登录Chrome。然而这样做会造成失去密钥环保护，所有密码都用明文保存在磁盘上，理论上是不够安全的。

可惜，目前还没找到更好的办法。目前还没有找到为什么Chrome突然就不会正确调用seahorse了。
